<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Manager v28 - Professional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/4.1.1/tesseract.min.js"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        .tab.active {
            background-color: #5D5CDE;
            color: white;
        }
        .btn {
            @apply px-4 py-2 rounded-lg font-medium transition-colors;
        }
        .btn-primary {
            @apply bg-blue-600 text-white hover:bg-blue-700;
        }
        .btn-secondary {
            @apply bg-gray-600 text-white hover:bg-gray-700;
        }
        .btn-success {
            @apply bg-green-600 text-white hover:bg-green-700;
        }
        .btn-danger {
            @apply bg-red-600 text-white hover:bg-red-700;
        }
        .btn-warning {
            @apply bg-yellow-600 text-white hover:bg-yellow-700;
        }
        .card {
            @apply bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 border dark:border-gray-700;
        }
        .form-group {
            @apply mb-4;
        }
        .form-label {
            @apply block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2;
        }
        .form-input {
            @apply w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base;
        }
        .notification {
            @apply fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 transition-all duration-300;
        }
        .notification.success {
            @apply bg-green-500 text-white;
        }
        .notification.error {
            @apply bg-red-500 text-white;
        }
        .notification.warning {
            @apply bg-yellow-500 text-white;
        }
        .tree-item {
            @apply cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 p-2 rounded;
        }
        .tree-cabinet {
            @apply font-bold text-blue-600 dark:text-blue-400;
        }
        .tree-shelf {
            @apply ml-4 text-green-600 dark:text-green-400;
        }
        .tree-item-entry {
            @apply ml-8 text-gray-600 dark:text-gray-400 text-sm;
        }
        .image-thumbnail {
            @apply w-20 h-20 object-cover rounded-lg border-2 border-gray-300 cursor-pointer hover:border-blue-500;
        }
        .loading-overlay {
            @apply fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50;
        }
        .modal {
            @apply fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50;
        }
        .modal-content {
            @apply bg-white dark:bg-gray-800 rounded-lg shadow-lg max-w-lg w-full mx-4 p-6;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-white">
    <div class="container mx-auto px-4 py-6 max-w-7xl">
        <!-- Header -->
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-bold text-gray-800 dark:text-white">Inventory Manager v28</h1>
            <div class="flex items-center space-x-4">
                <span class="text-sm text-gray-600 dark:text-gray-400">Items: <span id="total-items">0</span></span>
                <button onclick="inventoryManager.toggleTheme()" class="btn btn-secondary">üåì</button>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="flex flex-wrap gap-2 mb-6 border-b dark:border-gray-700">
            <button class="tab active" data-tab="dashboard">üìä Dashboard</button>
            <button class="tab" data-tab="items">üìù Item Details</button>
            <button class="tab" data-tab="locations">üìç Locations</button>
            <button class="tab" data-tab="overview">üóÇÔ∏è Inventory Overview</button>
            <button class="tab" data-tab="images">üñºÔ∏è Images</button>
            <button class="tab" data-tab="search">üîç Search</button>
            <button class="tab" data-tab="settings">‚öôÔ∏è Settings</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard-tab" class="tab-content">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                <div class="card">
                    <h3 class="text-lg font-semibold mb-2">Total Items</h3>
                    <p class="text-3xl font-bold text-blue-600" id="dashboard-total-items">0</p>
                </div>
                <div class="card">
                    <h3 class="text-lg font-semibold mb-2">Available Items</h3>
                    <p class="text-3xl font-bold text-green-600" id="dashboard-available-items">0</p>
                </div>
                <div class="card">
                    <h3 class="text-lg font-semibold mb-2">Sold Items</h3>
                    <p class="text-3xl font-bold text-red-600" id="dashboard-sold-items">0</p>
                </div>
                <div class="card">
                    <h3 class="text-lg font-semibold mb-2">Total Value</h3>
                    <p class="text-3xl font-bold text-purple-600" id="dashboard-total-value">$0.00</p>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card">
                    <h3 class="text-lg font-semibold mb-4">Recent Items</h3>
                    <div id="recent-items" class="space-y-2">
                        <p class="text-gray-500">No items added yet</p>
                    </div>
                </div>
                <div class="card">
                    <h3 class="text-lg font-semibold mb-4">Category Distribution</h3>
                    <div id="category-distribution" class="space-y-2">
                        <p class="text-gray-500">No data available</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Item Details Tab -->
        <div id="items-tab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Item Form -->
                <div class="lg:col-span-2">
                    <div class="card">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-semibold">Item Details</h2>
                            <div class="flex space-x-2">
                                <button onclick="inventoryManager.newItem()" class="btn btn-secondary">New Item</button>
                                <button onclick="inventoryManager.saveItem()" class="btn btn-primary">Save Item</button>
                            </div>
                        </div>

                        <form id="item-form" class="space-y-4">
                            <input type="hidden" id="item-id">
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="form-group">
                                    <label class="form-label">Item Name *</label>
                                    <input type="text" id="item-name" class="form-input" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Model #</label>
                                    <input type="text" id="item-model" class="form-input">
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="form-group">
                                    <label class="form-label">Qty Available</label>
                                    <input type="number" id="item-qty" class="form-input" value="1" min="0">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Item Condition</label>
                                    <select id="item-condition" class="form-input">
                                        <option value="">Select...</option>
                                        <option value="new">New</option>
                                        <option value="used">Used</option>
                                        <option value="refurbished">Refurbished</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Functionality</label>
                                    <select id="item-functionality" class="form-input">
                                        <option value="">Select...</option>
                                        <option value="working">Working</option>
                                        <option value="needs-repair">Needs Repair</option>
                                        <option value="unknown">Unknown</option>
                                    </select>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="form-group">
                                    <label class="form-label">Category</label>
                                    <select id="item-category" class="form-input">
                                        <option value="">Select...</option>
                                        <option value="electronics">Electronics</option>
                                        <option value="furniture">Furniture</option>
                                        <option value="tools">Tools</option>
                                        <option value="clothing">Clothing</option>
                                        <option value="books">Books</option>
                                        <option value="misc">Miscellaneous</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Date Added</label>
                                    <input type="date" id="item-date-added" class="form-input">
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="form-group">
                                    <label class="form-label">Cabinet</label>
                                    <select id="item-cabinet" class="form-input" onchange="inventoryManager.updateShelfOptions()">
                                        <option value="">Select Cabinet...</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Shelf</label>
                                    <select id="item-shelf" class="form-input">
                                        <option value="">Select Shelf...</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Weblink</label>
                                <input type="url" id="item-weblink" class="form-input" placeholder="https://example.com">
                            </div>

                            <div class="form-group">
                                <div class="flex items-center">
                                    <input type="checkbox" id="item-sold" class="mr-2">
                                    <label for="item-sold" class="form-label mb-0">Sold</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Description</label>
                                <textarea id="item-description" class="form-input" rows="4" placeholder="Enter item description..."></textarea>
                            </div>

                            <!-- Images Section -->
                            <div class="form-group">
                                <label class="form-label">Images</label>
                                <div id="item-images" class="flex flex-wrap gap-2 mb-3">
                                    <!-- Thumbnails will be displayed here -->
                                </div>
                                <div class="flex flex-wrap gap-2">
                                    <button type="button" onclick="inventoryManager.openCamera()" class="btn btn-secondary">üì∑ Camera</button>
                                    <button type="button" onclick="inventoryManager.openGoogleLens()" class="btn btn-warning">üîç Google Lens</button>
                                    <button type="button" onclick="inventoryManager.uploadImages()" class="btn btn-secondary">üìÅ Upload</button>
                                    <button type="button" onclick="inventoryManager.scanBarcode()" class="btn btn-secondary">üìä Scan Barcode</button>
                                    <button type="button" onclick="inventoryManager.processOCR()" class="btn btn-warning">üìÑ OCR Scan</button>
                                    <button type="button" onclick="inventoryManager.processAI()" class="btn btn-success">ü§ñ AI Process</button>
                                    <button type="button" onclick="inventoryManager.processAIAndOCR()" class="btn btn-primary">‚ú® AI+OCR</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Item Navigation -->
                <div class="space-y-6">
                    <div class="card">
                        <h3 class="text-lg font-semibold mb-4">Navigation</h3>
                        <div class="space-y-2">
                            <div class="form-group">
                                <label class="form-label">View Item #</label>
                                <div class="flex">
                                    <input type="number" id="view-item-id" class="form-input rounded-r-none" min="1">
                                    <button onclick="inventoryManager.viewItem()" class="btn btn-primary rounded-l-none">View</button>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="inventoryManager.previousItem()" class="btn btn-secondary flex-1">‚¨Ö Previous</button>
                                <button onclick="inventoryManager.nextItem()" class="btn btn-secondary flex-1">Next ‚û°</button>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h3 class="text-lg font-semibold mb-4">Quick Actions</h3>
                        <div class="space-y-2">
                            <button onclick="inventoryManager.duplicateItem()" class="btn btn-secondary w-full">üìã Duplicate Item</button>
                            <button onclick="inventoryManager.deleteItem()" class="btn btn-danger w-full">üóëÔ∏è Delete Item</button>
                            <button onclick="inventoryManager.printLabel()" class="btn btn-primary w-full">üè∑Ô∏è Print Label</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Locations Tab -->
        <div id="locations-tab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold">Location Hierarchy</h2>
                        <div class="flex space-x-2">
                            <button onclick="inventoryManager.addCabinet()" class="btn btn-primary">+ Add Cabinet</button>
                        </div>
                    </div>
                    <div id="location-tree" class="space-y-2 max-h-96 overflow-y-auto">
                        <!-- Location tree will be rendered here -->
                    </div>
                </div>

                <div class="card">
                    <h2 class="text-xl font-semibold mb-4">Location Management</h2>
                    
                    <div class="space-y-4">
                        <div>
                            <h3 class="text-lg font-medium mb-2">Cabinets</h3>
                            <div id="cabinets-list" class="space-y-2 mb-4">
                                <!-- Cabinet list will be rendered here -->
                            </div>
                        </div>

                        <div>
                            <h3 class="text-lg font-medium mb-2">Shelves</h3>
                            <div id="shelves-list" class="space-y-2">
                                <!-- Shelf list will be rendered here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Inventory Overview Tab -->
        <div id="overview-tab" class="tab-content hidden">
            <div class="space-y-6">
                <!-- Top View Section -->
                <div class="card">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold">üìç Locations Top View</h2>
                        <div class="text-sm text-gray-600 dark:text-gray-400">
                            Total Cabinets: <span id="overview-total-cabinets">0</span> | 
                            Total Shelves: <span id="overview-total-shelves">0</span> | 
                            Items Placed: <span id="overview-placed-items">0</span>
                        </div>
                    </div>
                    <div id="overview-top-view" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 min-h-32">
                        <!-- Top view cabinets will be rendered here -->
                    </div>
                </div>

                <!-- Detailed Cabinet View -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="card">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-semibold">üóÇÔ∏è Cabinet + Shelves + Items View</h2>
                            <div class="flex space-x-2">
                                <select id="overview-cabinet-filter" class="form-input text-sm">
                                    <option value="">All Cabinets</option>
                                </select>
                            </div>
                        </div>
                        <div id="overview-detailed-view" class="space-y-4 max-h-96 overflow-y-auto">
                            <!-- Detailed view will be rendered here -->
                        </div>
                    </div>

                    <div class="card">
                        <h2 class="text-xl font-semibold mb-4">üìã Complete Items List</h2>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-2">
                                <span>Click on any item to view details</span>
                                <button onclick="inventoryManager.exportLocationReport()" class="btn btn-secondary text-xs">üìÑ Export Report</button>
                            </div>
                            <div id="overview-items-list" class="space-y-1 max-h-80 overflow-y-auto">
                                <!-- Complete items list will be rendered here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Statistics Section -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="card">
                        <h3 class="text-lg font-semibold mb-3">üìä Location Statistics</h3>
                        <div id="overview-location-stats" class="space-y-2">
                            <!-- Location statistics will be rendered here -->
                        </div>
                    </div>

                    <div class="card">
                        <h3 class="text-lg font-semibold mb-3">üìà Category Distribution</h3>
                        <div id="overview-category-stats" class="space-y-2">
                            <!-- Category statistics will be rendered here -->
                        </div>
                    </div>

                    <div class="card">
                        <h3 class="text-lg font-semibold mb-3">‚ö° Quick Actions</h3>
                        <div class="space-y-2">
                            <button onclick="inventoryManager.findMisplacedItems()" class="btn btn-warning w-full text-sm">üîç Find Unlocated Items</button>
                            <button onclick="inventoryManager.generateLocationLabels()" class="btn btn-primary w-full text-sm">üè∑Ô∏è Print Location Labels</button>
                            <button onclick="inventoryManager.optimizeLayout()" class="btn btn-success w-full text-sm">üéØ Suggest Layout</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Images Tab -->
        <div id="images-tab" class="tab-content hidden">
            <div class="card">
                <h2 class="text-xl font-semibold mb-4">All Images</h2>
                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4" id="all-images-grid">
                    <!-- All images will be displayed here -->
                </div>
            </div>
        </div>

        <!-- Search Tab -->
        <div id="search-tab" class="tab-content hidden">
            <div class="card">
                <h2 class="text-xl font-semibold mb-4">Search Items</h2>
                
                <div class="mb-6">
                    <div class="flex gap-4 mb-4">
                        <input type="text" id="search-input" class="form-input flex-1" placeholder="Search by name, model, category, or description...">
                        <button onclick="inventoryManager.searchItems()" class="btn btn-primary">üîç Search</button>
                        <button onclick="inventoryManager.clearSearch()" class="btn btn-secondary">Clear</button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <select id="search-category" class="form-input">
                            <option value="">All Categories</option>
                            <option value="electronics">Electronics</option>
                            <option value="furniture">Furniture</option>
                            <option value="tools">Tools</option>
                            <option value="clothing">Clothing</option>
                            <option value="books">Books</option>
                            <option value="misc">Miscellaneous</option>
                        </select>
                        <select id="search-condition" class="form-input">
                            <option value="">All Conditions</option>
                            <option value="new">New</option>
                            <option value="used">Used</option>
                            <option value="refurbished">Refurbished</option>
                        </select>
                        <select id="search-location" class="form-input">
                            <option value="">All Locations</option>
                        </select>
                        <select id="search-status" class="form-input">
                            <option value="">All Status</option>
                            <option value="available">Available</option>
                            <option value="sold">Sold</option>
                        </select>
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full table-auto">
                        <thead>
                            <tr class="bg-gray-100 dark:bg-gray-700">
                                <th class="px-4 py-2 text-left">ID</th>
                                <th class="px-4 py-2 text-left">Image</th>
                                <th class="px-4 py-2 text-left">Name</th>
                                <th class="px-4 py-2 text-left">Model</th>
                                <th class="px-4 py-2 text-left">Category</th>
                                <th class="px-4 py-2 text-left">Location</th>
                                <th class="px-4 py-2 text-left">Status</th>
                                <th class="px-4 py-2 text-left">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="search-results">
                            <tr>
                                <td colspan="8" class="px-4 py-8 text-center text-gray-500">Use the search box above to find items</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings-tab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card">
                    <h2 class="text-xl font-semibold mb-4">OCR Settings</h2>
                    
                    <div class="form-group">
                        <label class="form-label">OCR Method</label>
                        <select id="ocr-method" class="form-input">
                            <option value="tesseract">Tesseract.js (Free)</option>
                            <option value="paddleocr">PaddleOCR</option>
                            <option value="azure">Azure OCR</option>
                            <option value="aws">AWS Textract</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Azure OCR API Key</label>
                        <input type="password" id="azure-ocr-key" class="form-input" placeholder="Enter Azure OCR API key">
                    </div>

                    <div class="form-group">
                        <label class="form-label">AWS Access Key</label>
                        <input type="password" id="aws-access-key" class="form-input" placeholder="Enter AWS access key">
                    </div>

                    <div class="form-group">
                        <label class="form-label">AWS Secret Key</label>
                        <input type="password" id="aws-secret-key" class="form-input" placeholder="Enter AWS secret key">
                    </div>
                </div>

                <div class="card">
                    <h2 class="text-xl font-semibold mb-4">AI Settings</h2>
                    
                    <div class="form-group">
                        <label class="form-label">AI Method</label>
                        <select id="ai-method" class="form-input">
                            <option value="offline">Smart Offline</option>
                            <option value="openai">OpenAI GPT</option>
                            <option value="cohere">Cohere</option>
                            <option value="claude">Anthropic Claude</option>
                            <option value="huggingface">Hugging Face</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">OpenAI API Key</label>
                        <input type="password" id="openai-key" class="form-input" placeholder="Enter OpenAI API key">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Cohere API Key</label>
                        <input type="password" id="cohere-key" class="form-input" placeholder="Enter Cohere API key">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Claude API Key</label>
                        <input type="password" id="claude-key" class="form-input" placeholder="Enter Claude API key">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Hugging Face API Key</label>
                        <input type="password" id="huggingface-key" class="form-input" placeholder="Enter Hugging Face API key">
                    </div>
                </div>

                <div class="card lg:col-span-2">
                    <h2 class="text-xl font-semibold mb-4">Data Management & Android Features</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="space-y-2">
                            <h3 class="font-medium">Local Storage</h3>
                            <button onclick="inventoryManager.exportDatabase()" class="btn btn-primary w-full">üì• Export Data</button>
                            <input type="file" id="import-file" accept=".json" style="display: none;" onchange="inventoryManager.importDatabase(event)">
                            <button onclick="document.getElementById('import-file').click()" class="btn btn-secondary w-full">üì§ Import Data</button>
                        </div>
                        
                        <div class="space-y-2">
                            <h3 class="font-medium">Android Local Save</h3>
                            <button onclick="inventoryManager.saveToAndroidDirectory()" class="btn btn-success w-full">üì± Save to Android</button>
                            <div class="text-sm text-gray-600 dark:text-gray-400">
                                Save directly to Android storage
                            </div>
                        </div>

                        <div class="space-y-2">
                            <h3 class="font-medium">Google Cloud</h3>
                            <button onclick="inventoryManager.signInToGoogle()" class="btn btn-warning w-full">üîê Google Sign-In</button>
                            <button onclick="inventoryManager.backupToGoogleDrive()" class="btn btn-primary w-full">‚òÅÔ∏è Backup to Drive</button>
                            <button onclick="inventoryManager.restoreFromGoogleDrive()" class="btn btn-secondary w-full">üì• Restore from Drive</button>
                        </div>

                        <div class="space-y-2">
                            <h3 class="font-medium">Auto Features</h3>
                            <div class="flex items-center mb-2">
                                <input type="checkbox" id="auto-save" class="mr-2" checked>
                                <label for="auto-save" class="text-sm">Auto-Save</label>
                            </div>
                            <div class="flex items-center mb-2">
                                <input type="checkbox" id="auto-backup" class="mr-2">
                                <label for="auto-backup" class="text-sm">Auto Google Backup</label>
                            </div>
                            <button onclick="inventoryManager.validateSettings()" class="btn btn-warning w-full text-xs">‚úÖ Validate APIs</button>
                        </div>
                    </div>

                    <div class="border-t dark:border-gray-600 pt-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <h3 class="font-medium mb-2">Google Account Status</h3>
                                <div id="google-status" class="text-sm text-gray-600 dark:text-gray-400">
                                    Not signed in
                                </div>
                            </div>
                            <div>
                                <h3 class="font-medium mb-2">Android Device Detection</h3>
                                <div id="android-status" class="text-sm text-gray-600 dark:text-gray-400">
                                    Checking...
                                </div>
                            </div>
                        </div>
                        <button onclick="inventoryManager.saveSettings()" class="btn btn-success">üíæ Save All Settings</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden file inputs -->
    <input type="file" id="hidden-file-input" multiple accept="image/*" style="display: none;">
    <input type="file" id="hidden-camera-input" accept="image/*" capture="camera" style="display: none;">

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p id="loading-text">Processing...</p>
        </div>
    </div>

    <!-- Camera Modal -->
    <div id="camera-modal" class="modal hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">Camera</h3>
                <button onclick="inventoryManager.closeCamera()" class="text-gray-500 hover:text-gray-700">‚úï</button>
            </div>
            <video id="camera-video" class="w-full h-64 bg-black rounded-lg mb-4"></video>
            <div class="flex space-x-2">
                <button onclick="inventoryManager.capturePhoto()" class="btn btn-primary flex-1">üì∏ Capture</button>
                <button onclick="inventoryManager.closeCamera()" class="btn btn-secondary">Close</button>
            </div>
        </div>
    </div>

    <!-- Image Viewer Modal -->
    <div id="image-viewer-modal" class="modal hidden">
        <div class="modal-content max-w-4xl">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">Image Viewer</h3>
                <button onclick="inventoryManager.closeImageViewer()" class="text-gray-500 hover:text-gray-700">‚úï</button>
            </div>
            <img id="image-viewer-img" class="w-full max-h-96 object-contain rounded-lg mb-4">
            <div class="flex space-x-2">
                <button onclick="inventoryManager.processImageOCR()" class="btn btn-warning">üìÑ OCR</button>
                <button onclick="inventoryManager.processImageAI()" class="btn btn-success">ü§ñ AI Describe</button>
                <button onclick="inventoryManager.deleteImage()" class="btn btn-danger">üóëÔ∏è Delete</button>
                <button onclick="inventoryManager.closeImageViewer()" class="btn btn-secondary">Close</button>
            </div>
        </div>
    </div>

    <script>
        class InventoryManager {
            constructor() {
                this.items = [];
                this.cabinets = [];
                this.shelves = [];
                this.currentItemId = null;
                this.currentImages = [];
                this.settings = {
                    ocrMethod: 'tesseract',
                    aiMethod: 'offline',
                    autoSave: true,
                    apiKeys: {}
                };
                
                this.init();
            }

            async init() {
                this.setupEventListeners();
                this.setupTheme();
                await this.loadData();
                this.updateUI();
                this.checkAndroidDevice();
                this.initGoogleSignIn();
                this.switchToTab('dashboard');
            }

            checkAndroidDevice() {
                const isAndroid = /Android/i.test(navigator.userAgent);
                const androidStatus = document.getElementById('android-status');
                if (androidStatus) {
                    androidStatus.textContent = isAndroid ? 
                        '‚úÖ Android device detected' : 
                        '‚ùå Not an Android device';
                    androidStatus.className = isAndroid ? 
                        'text-sm text-green-600' : 
                        'text-sm text-gray-600 dark:text-gray-400';
                }
            }

            setupEventListeners() {
                // Tab switching
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const tabName = e.target.getAttribute('data-tab');
                        this.switchToTab(tabName);
                    });
                });

                // File inputs
                document.getElementById('hidden-file-input').addEventListener('change', (e) => {
                    this.handleFileUpload(e);
                });

                document.getElementById('hidden-camera-input').addEventListener('change', (e) => {
                    this.handleFileUpload(e);
                });

                // Auto-save on form changes
                document.getElementById('item-form').addEventListener('input', () => {
                    if (this.settings.autoSave) {
                        this.debounce(() => this.saveItem(), 1000)();
                    }
                });

                // Search functionality
                document.getElementById('search-input').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.searchItems();
                    }
                });

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey) {
                        switch (e.key) {
                            case 's':
                                e.preventDefault();
                                this.saveItem();
                                break;
                            case 'n':
                                e.preventDefault();
                                this.newItem();
                                break;
                            case 'f':
                                e.preventDefault();
                                this.switchToTab('search');
                                break;
                            case 'd':
                                e.preventDefault();
                                this.switchToTab('dashboard');
                                break;
                        }
                    }
                });
            }

            setupTheme() {
                // Use system preference since localStorage is not available
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.classList.add('dark');
                }

                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                    if (e.matches) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                });
            }

            async loadData() {
                try {
                    // Since localStorage is not available in sandbox, we'll start with empty data
                    // Data persistence will be handled through export/import and Google Drive
                    this.items = [];
                    this.cabinets = [];
                    this.shelves = [];
                    
                    // Try to load from a global variable if available (for session persistence)
                    if (window.inventoryAppData) {
                        this.items = window.inventoryAppData.items || [];
                        this.cabinets = window.inventoryAppData.cabinets || [];
                        this.shelves = window.inventoryAppData.shelves || [];
                    }
                } catch (error) {
                    console.error('Error loading data:', error);
                }
            }

            async saveData() {
                try {
                    // Save to global variable for session persistence
                    window.inventoryAppData = {
                        items: this.items,
                        cabinets: this.cabinets,
                        shelves: this.shelves,
                        lastSaved: new Date().toISOString()
                    };
                    
                    // Auto-backup to Google Drive if enabled and signed in
                    if (this.settings.autoBackup && this.googleUser && this.googleUser.isSignedIn()) {
                        this.debounce(() => this.backupToGoogleDrive(), 5000)();
                    }
                } catch (error) {
                    console.error('Error saving data:', error);
                }
            }

            switchToTab(tabName) {
                // Update tab buttons
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
                
                // Update tab content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById(`${tabName}-tab`).classList.remove('hidden');
                
                // Load tab-specific data
                switch (tabName) {
                    case 'dashboard':
                        this.updateDashboard();
                        break;
                    case 'items':
                        this.updateItemForm();
                        break;
                    case 'locations':
                        this.renderLocationTree();
                        this.renderLocationManagement();
                        break;
                    case 'overview':
                        this.renderInventoryOverview();
                        break;
                    case 'images':
                        this.loadAllImages();
                        break;
                    case 'search':
                        this.updateSearchFilters();
                        break;
                    case 'settings':
                        this.loadSettings();
                        break;
                }
            }

            updateUI() {
                document.getElementById('total-items').textContent = this.items.length;
                this.updateItemForm();
                this.renderLocationTree();
                this.updateDashboard();
            }

            // Dashboard Methods
            updateDashboard() {
                const totalItems = this.items.length;
                const availableItems = this.items.filter(item => !item.sold).length;
                const soldItems = this.items.filter(item => item.sold).length;
                const totalValue = this.items.filter(item => !item.sold)
                    .reduce((sum, item) => sum + (parseFloat(item.value) || 0), 0);

                document.getElementById('dashboard-total-items').textContent = totalItems;
                document.getElementById('dashboard-available-items').textContent = availableItems;
                document.getElementById('dashboard-sold-items').textContent = soldItems;
                document.getElementById('dashboard-total-value').textContent = `$${totalValue.toFixed(2)}`;

                this.renderRecentItems();
                this.renderCategoryDistribution();
            }

            renderRecentItems() {
                const container = document.getElementById('recent-items');
                const recentItems = this.items
                    .sort((a, b) => new Date(b.dateAdded) - new Date(a.dateAdded))
                    .slice(0, 5);

                if (recentItems.length === 0) {
                    container.innerHTML = '<p class="text-gray-500">No items added yet</p>';
                    return;
                }

                container.innerHTML = recentItems.map(item => `
                    <div class="flex justify-between items-center p-2 bg-gray-50 dark:bg-gray-700 rounded cursor-pointer" onclick="inventoryManager.viewItemById('${item.id}')">
                        <div>
                            <div class="font-medium">${item.name || 'Unnamed Item'}</div>
                            <div class="text-sm text-gray-500">${item.category || 'No category'}</div>
                        </div>
                        <div class="text-sm text-gray-500">${new Date(item.dateAdded).toLocaleDateString()}</div>
                    </div>
                `).join('');
            }

            renderCategoryDistribution() {
                const container = document.getElementById('category-distribution');
                const categories = {};
                
                this.items.forEach(item => {
                    const category = item.category || 'Uncategorized';
                    categories[category] = (categories[category] || 0) + 1;
                });

                if (Object.keys(categories).length === 0) {
                    container.innerHTML = '<p class="text-gray-500">No data available</p>';
                    return;
                }

                container.innerHTML = Object.entries(categories)
                    .sort(([,a], [,b]) => b - a)
                    .map(([category, count]) => `
                        <div class="flex justify-between items-center">
                            <span>${category}</span>
                            <span class="font-medium">${count}</span>
                        </div>
                    `).join('');
            }

            // Item Management Methods
            newItem() {
                this.currentItemId = this.generateId();
                this.currentImages = [];
                document.getElementById('item-form').reset();
                document.getElementById('item-id').value = this.currentItemId;
                document.getElementById('item-qty').value = '1';
                document.getElementById('item-date-added').value = new Date().toISOString().split('T')[0];
                this.renderItemImages();
                this.switchToTab('items');
            }

            async saveItem() {
                try {
                    const formData = new FormData(document.getElementById('item-form'));
                    const itemData = {
                        id: document.getElementById('item-id').value || this.generateId(),
                        name: document.getElementById('item-name').value,
                        model: document.getElementById('item-model').value,
                        description: document.getElementById('item-description').value,
                        qty: parseInt(document.getElementById('item-qty').value) || 1,
                        condition: document.getElementById('item-condition').value,
                        functionality: document.getElementById('item-functionality').value,
                        category: document.getElementById('item-category').value,
                        cabinetId: document.getElementById('item-cabinet').value,
                        shelfId: document.getElementById('item-shelf').value,
                        weblink: document.getElementById('item-weblink').value,
                        dateAdded: document.getElementById('item-date-added').value,
                        sold: document.getElementById('item-sold').checked,
                        images: this.currentImages,
                        lastModified: new Date().toISOString()
                    };

                    const existingIndex = this.items.findIndex(item => item.id === itemData.id);
                    if (existingIndex >= 0) {
                        this.items[existingIndex] = itemData;
                    } else {
                        this.items.push(itemData);
                    }

                    this.currentItemId = itemData.id;
                    await this.saveData();
                    this.updateUI();
                    this.showNotification('Item saved successfully!', 'success');
                } catch (error) {
                    console.error('Error saving item:', error);
                    this.showNotification('Failed to save item', 'error');
                }
            }

            viewItem() {
                const itemId = document.getElementById('view-item-id').value;
                if (itemId) {
                    this.viewItemById(itemId);
                }
            }

            viewItemById(itemId) {
                const item = this.items.find(i => i.id === itemId);
                if (item) {
                    this.loadItemToForm(item);
                    this.switchToTab('items');
                } else {
                    this.showNotification('Item not found', 'error');
                }
            }

            loadItemToForm(item) {
                this.currentItemId = item.id;
                this.currentImages = item.images || [];
                
                document.getElementById('item-id').value = item.id;
                document.getElementById('item-name').value = item.name || '';
                document.getElementById('item-model').value = item.model || '';
                document.getElementById('item-description').value = item.description || '';
                document.getElementById('item-qty').value = item.qty || 1;
                document.getElementById('item-condition').value = item.condition || '';
                document.getElementById('item-functionality').value = item.functionality || '';
                document.getElementById('item-category').value = item.category || '';
                document.getElementById('item-cabinet').value = item.cabinetId || '';
                document.getElementById('item-weblink').value = item.weblink || '';
                document.getElementById('item-date-added').value = item.dateAdded || '';
                document.getElementById('item-sold').checked = item.sold || false;
                
                this.updateShelfOptions();
                document.getElementById('item-shelf').value = item.shelfId || '';
                
                this.renderItemImages();
            }

            previousItem() {
                if (this.items.length === 0) return;
                
                const currentIndex = this.currentItemId ? 
                    this.items.findIndex(item => item.id === this.currentItemId) : -1;
                const prevIndex = currentIndex <= 0 ? this.items.length - 1 : currentIndex - 1;
                
                this.loadItemToForm(this.items[prevIndex]);
            }

            nextItem() {
                if (this.items.length === 0) return;
                
                const currentIndex = this.currentItemId ? 
                    this.items.findIndex(item => item.id === this.currentItemId) : -1;
                const nextIndex = currentIndex >= this.items.length - 1 ? 0 : currentIndex + 1;
                
                this.loadItemToForm(this.items[nextIndex]);
            }

            duplicateItem() {
                if (!this.currentItemId) {
                    this.showNotification('No item to duplicate', 'error');
                    return;
                }

                const currentItem = this.items.find(item => item.id === this.currentItemId);
                if (currentItem) {
                    const duplicatedItem = {
                        ...currentItem,
                        id: this.generateId(),
                        name: `${currentItem.name} (Copy)`,
                        dateAdded: new Date().toISOString().split('T')[0]
                    };
                    
                    this.loadItemToForm(duplicatedItem);
                    this.showNotification('Item duplicated', 'success');
                }
            }

            deleteItem() {
                if (!this.currentItemId) {
                    this.showNotification('No item to delete', 'error');
                    return;
                }

                this.showConfirmDialog('Are you sure you want to delete this item?', () => {
                    const index = this.items.findIndex(item => item.id === this.currentItemId);
                    if (index >= 0) {
                        this.items.splice(index, 1);
                        this.saveData();
                        this.newItem();
                        this.updateUI();
                        this.showNotification('Item deleted successfully', 'success');
                    }
                });
            }

            printLabel() {
                if (!this.currentItemId) {
                    this.showNotification('No item to print', 'error');
                    return;
                }

                const item = this.items.find(i => i.id === this.currentItemId);
                if (item) {
                    const printWindow = window.open('', '_blank');
                    printWindow.document.write(`
                        <html>
                            <head><title>Item Label</title></head>
                            <body style="font-family: Arial, sans-serif; padding: 20px;">
                                <div style="border: 2px solid #000; padding: 20px; width: 300px;">
                                    <h2>${item.name || 'Unnamed Item'}</h2>
                                    <p><strong>ID:</strong> ${item.id}</p>
                                    <p><strong>Model:</strong> ${item.model || 'N/A'}</p>
                                    <p><strong>Category:</strong> ${item.category || 'N/A'}</p>
                                    <p><strong>Location:</strong> ${this.getLocationString(item)}</p>
                                </div>
                            </body>
                        </html>
                    `);
                    printWindow.document.close();
                    printWindow.print();
                }
            }

            // Location Management Methods
            updateItemForm() {
                this.renderCabinetsDropdown();
            }

            renderCabinetsDropdown() {
                const cabinetSelect = document.getElementById('item-cabinet');
                cabinetSelect.innerHTML = '<option value="">Select Cabinet...</option>';
                
                this.cabinets.forEach(cabinet => {
                    const option = document.createElement('option');
                    option.value = cabinet.id;
                    option.textContent = cabinet.name;
                    cabinetSelect.appendChild(option);
                });
            }

            updateShelfOptions() {
                const cabinetId = document.getElementById('item-cabinet').value;
                const shelfSelect = document.getElementById('item-shelf');
                
                shelfSelect.innerHTML = '<option value="">Select Shelf...</option>';
                
                if (cabinetId) {
                    const shelves = this.shelves.filter(shelf => shelf.cabinetId === cabinetId);
                    shelves.forEach(shelf => {
                        const option = document.createElement('option');
                        option.value = shelf.id;
                        option.textContent = shelf.name;
                        shelfSelect.appendChild(option);
                    });
                }
            }

            addCabinet() {
                this.showPromptDialog('Enter cabinet name:', (name) => {
                    if (name && name.trim()) {
                        const cabinet = {
                            id: this.generateId(),
                            name: name.trim()
                        };
                        this.cabinets.push(cabinet);
                        this.saveData();
                        this.renderLocationTree();
                        this.renderLocationManagement();
                        this.updateItemForm();
                        this.showNotification('Cabinet added successfully!', 'success');
                    }
                });
            }

            addShelf(cabinetId) {
                this.showPromptDialog('Enter shelf name:', (name) => {
                    if (name && name.trim()) {
                        const shelf = {
                            id: this.generateId(),
                            name: name.trim(),
                            cabinetId: cabinetId
                        };
                        this.shelves.push(shelf);
                        this.saveData();
                        this.renderLocationTree();
                        this.renderLocationManagement();
                        this.updateItemForm();
                        this.showNotification('Shelf added successfully!', 'success');
                    }
                });
            }

            renderLocationTree() {
                const container = document.getElementById('location-tree');
                container.innerHTML = '';

                if (this.cabinets.length === 0) {
                    container.innerHTML = '<p class="text-gray-500">No cabinets created yet</p>';
                    return;
                }

                this.cabinets.forEach(cabinet => {
                    const cabinetDiv = document.createElement('div');
                    cabinetDiv.className = 'mb-4';
                    
                    cabinetDiv.innerHTML = `
                        <div class="tree-item tree-cabinet flex justify-between items-center">
                            <span>üì¶ ${cabinet.name}</span>
                            <button data-cabinet-id="${cabinet.id}" class="btn btn-primary text-xs add-shelf-btn">+ Add Shelf</button>
                        </div>
                    `;

                    // Add event listener for the Add Shelf button
                    const addShelfBtn = cabinetDiv.querySelector('.add-shelf-btn');
                    addShelfBtn.addEventListener('click', () => {
                        this.addShelf(cabinet.id);
                    });

                    const shelvesDiv = document.createElement('div');
                    shelvesDiv.className = 'ml-4 mt-2';

                    const cabinetShelves = this.shelves.filter(shelf => shelf.cabinetId === cabinet.id);
                    cabinetShelves.forEach(shelf => {
                        const shelfDiv = document.createElement('div');
                        shelfDiv.className = 'tree-item tree-shelf mb-2';
                        shelfDiv.innerHTML = `üìö ${shelf.name}`;

                        const itemsDiv = document.createElement('div');
                        itemsDiv.className = 'ml-4 mt-1';

                        const shelfItems = this.items.filter(item => item.shelfId === shelf.id);
                        shelfItems.forEach(item => {
                            const itemDiv = document.createElement('div');
                            itemDiv.className = 'tree-item tree-item-entry cursor-pointer hover:bg-blue-100 dark:hover:bg-blue-900';
                            itemDiv.innerHTML = `üìÑ ${item.name || 'Unnamed Item'} ${item.sold ? '(SOLD)' : ''}`;
                            itemDiv.onclick = () => this.viewItemById(item.id);
                            itemsDiv.appendChild(itemDiv);
                        });

                        if (shelfItems.length === 0) {
                            itemsDiv.innerHTML = '<div class="tree-item-entry text-gray-400">No items</div>';
                        }

                        shelfDiv.appendChild(itemsDiv);
                        shelvesDiv.appendChild(shelfDiv);
                    });

                    if (cabinetShelves.length === 0) {
                        shelvesDiv.innerHTML = '<div class="tree-shelf text-gray-400">No shelves</div>';
                    }

                    cabinetDiv.appendChild(shelvesDiv);
                    container.appendChild(cabinetDiv);
                });
            }

            renderLocationManagement() {
                // Render cabinets list
                const cabinetsList = document.getElementById('cabinets-list');
                cabinetsList.innerHTML = '';

                this.cabinets.forEach(cabinet => {
                    const div = document.createElement('div');
                    div.className = 'flex justify-between items-center p-2 bg-gray-50 dark:bg-gray-700 rounded';
                    div.innerHTML = `
                        <span>${cabinet.name}</span>
                        <div class="flex space-x-2">
                            <button class="btn btn-primary text-xs edit-cabinet-btn" data-cabinet-id="${cabinet.id}">Edit</button>
                            <button class="btn btn-danger text-xs delete-cabinet-btn" data-cabinet-id="${cabinet.id}">Delete</button>
                        </div>
                    `;
                    
                    // Add event listeners
                    div.querySelector('.edit-cabinet-btn').addEventListener('click', () => {
                        this.editCabinet(cabinet.id);
                    });
                    div.querySelector('.delete-cabinet-btn').addEventListener('click', () => {
                        this.deleteCabinet(cabinet.id);
                    });
                    
                    cabinetsList.appendChild(div);
                });

                // Render shelves list
                const shelvesList = document.getElementById('shelves-list');
                shelvesList.innerHTML = '';

                this.shelves.forEach(shelf => {
                    const cabinet = this.cabinets.find(c => c.id === shelf.cabinetId);
                    const div = document.createElement('div');
                    div.className = 'flex justify-between items-center p-2 bg-gray-50 dark:bg-gray-700 rounded';
                    div.innerHTML = `
                        <span>${shelf.name} <small>(${cabinet ? cabinet.name : 'Unknown Cabinet'})</small></span>
                        <div class="flex space-x-2">
                            <button class="btn btn-primary text-xs edit-shelf-btn" data-shelf-id="${shelf.id}">Edit</button>
                            <button class="btn btn-danger text-xs delete-shelf-btn" data-shelf-id="${shelf.id}">Delete</button>
                        </div>
                    `;
                    
                    // Add event listeners
                    div.querySelector('.edit-shelf-btn').addEventListener('click', () => {
                        this.editShelf(shelf.id);
                    });
                    div.querySelector('.delete-shelf-btn').addEventListener('click', () => {
                        this.deleteShelf(shelf.id);
                    });
                    
                    shelvesList.appendChild(div);
                });
            }

            editCabinet(cabinetId) {
                const cabinet = this.cabinets.find(c => c.id === cabinetId);
                if (cabinet) {
                    this.showPromptDialog('Edit cabinet name:', (name) => {
                        if (name && name.trim() && name !== cabinet.name) {
                            cabinet.name = name.trim();
                            this.saveData();
                            this.renderLocationTree();
                            this.renderLocationManagement();
                            this.updateItemForm();
                            this.showNotification('Cabinet updated successfully!', 'success');
                        }
                    }, cabinet.name);
                }
            }

            editShelf(shelfId) {
                const shelf = this.shelves.find(s => s.id === shelfId);
                if (shelf) {
                    this.showPromptDialog('Edit shelf name:', (name) => {
                        if (name && name.trim() && name !== shelf.name) {
                            shelf.name = name.trim();
                            this.saveData();
                            this.renderLocationTree();
                            this.renderLocationManagement();
                            this.updateItemForm();
                            this.showNotification('Shelf updated successfully!', 'success');
                        }
                    }, shelf.name);
                }
            }

            deleteCabinet(cabinetId) {
                this.showConfirmDialog('Are you sure you want to delete this cabinet? Items in this cabinet will lose their location data.', () => {
                    // Remove cabinet
                    this.cabinets = this.cabinets.filter(c => c.id !== cabinetId);
                    
                    // Remove associated shelves
                    this.shelves = this.shelves.filter(s => s.cabinetId !== cabinetId);
                    
                    // Update items to remove location data
                    this.items.forEach(item => {
                        if (item.cabinetId === cabinetId) {
                            item.cabinetId = '';
                            item.shelfId = '';
                        }
                    });
                    
                    this.saveData();
                    this.renderLocationTree();
                    this.renderLocationManagement();
                    this.updateItemForm();
                    this.showNotification('Cabinet deleted successfully!', 'success');
                });
            }

            deleteShelf(shelfId) {
                this.showConfirmDialog('Are you sure you want to delete this shelf? Items on this shelf will lose their shelf location.', () => {
                    // Remove shelf
                    this.shelves = this.shelves.filter(s => s.id !== shelfId);
                    
                    // Update items to remove shelf data
                    this.items.forEach(item => {
                        if (item.shelfId === shelfId) {
                            item.shelfId = '';
                        }
                    });
                    
                    this.saveData();
                    this.renderLocationTree();
                    this.renderLocationManagement();
                    this.updateItemForm();
                    this.showNotification('Shelf deleted successfully!', 'success');
                });
            }

            getLocationString(item) {
                const cabinet = this.cabinets.find(c => c.id === item.cabinetId);
                const shelf = this.shelves.find(s => s.id === item.shelfId);
                
                if (cabinet && shelf) {
                    return `${cabinet.name} > ${shelf.name}`;
                } else if (cabinet) {
                    return cabinet.name;
                } else {
                    return 'No location';
                }
            }

            // Inventory Overview Methods
            renderInventoryOverview() {
                this.renderOverviewStats();
                this.renderTopView();
                this.renderDetailedView();
                this.renderCompleteItemsList();
                this.renderOverviewStatistics();
                this.setupOverviewFilters();
            }

            renderOverviewStats() {
                document.getElementById('overview-total-cabinets').textContent = this.cabinets.length;
                document.getElementById('overview-total-shelves').textContent = this.shelves.length;
                
                const placedItems = this.items.filter(item => item.cabinetId && item.shelfId).length;
                document.getElementById('overview-placed-items').textContent = placedItems;
            }

            renderTopView() {
                const container = document.getElementById('overview-top-view');
                container.innerHTML = '';

                if (this.cabinets.length === 0) {
                    container.innerHTML = '<div class="col-span-full flex items-center justify-center p-8 text-gray-500 border-2 border-dashed border-gray-300 rounded-lg">No cabinets created yet</div>';
                    return;
                }

                this.cabinets.forEach(cabinet => {
                    const cabinetItems = this.items.filter(item => item.cabinetId === cabinet.id);
                    const itemCount = cabinetItems.length;
                    const shelfCount = this.shelves.filter(shelf => shelf.cabinetId === cabinet.id).length;

                    const div = document.createElement('div');
                    div.className = 'relative bg-gradient-to-br from-blue-100 to-blue-200 dark:from-blue-800 dark:to-blue-900 border-2 border-blue-300 dark:border-blue-600 rounded-lg p-4 hover:shadow-lg transition-all cursor-pointer';
                    div.onclick = () => this.selectCabinetInDetailView(cabinet.id);
                    
                    div.innerHTML = `
                        <div class="text-center">
                            <div class="text-2xl mb-2">üì¶</div>
                            <div class="font-semibold text-sm mb-1">${cabinet.name}</div>
                            <div class="text-xs text-gray-600 dark:text-gray-300">
                                ${shelfCount} shelves<br>
                                ${itemCount} items
                            </div>
                        </div>
                        ${itemCount > 0 ? '<div class="absolute top-1 right-1 w-3 h-3 bg-green-500 rounded-full"></div>' : ''}
                    `;
                    container.appendChild(div);
                });
            }

            renderDetailedView() {
                const container = document.getElementById('overview-detailed-view');
                const filterValue = document.getElementById('overview-cabinet-filter').value;
                
                container.innerHTML = '';

                let cabinetList = filterValue ? 
                    this.cabinets.filter(c => c.id === filterValue) : 
                    this.cabinets;

                if (cabinetList.length === 0) {
                    container.innerHTML = '<div class="text-gray-500 text-center py-8">No cabinets to display</div>';
                    return;
                }

                cabinetList.forEach(cabinet => {
                    const cabinetDiv = document.createElement('div');
                    cabinetDiv.className = 'border border-gray-200 dark:border-gray-600 rounded-lg p-4 bg-gray-50 dark:bg-gray-700';
                    
                    const cabinetShelves = this.shelves.filter(shelf => shelf.cabinetId === cabinet.id);
                    
                    cabinetDiv.innerHTML = `
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="font-semibold text-blue-600 dark:text-blue-400">üì¶ ${cabinet.name}</h3>
                            <span class="text-xs text-gray-500">${cabinetShelves.length} shelves</span>
                        </div>
                    `;

                    const shelvesContainer = document.createElement('div');
                    shelvesContainer.className = 'space-y-2';

                    if (cabinetShelves.length === 0) {
                        shelvesContainer.innerHTML = '<div class="text-gray-400 text-sm pl-4">No shelves</div>';
                    } else {
                        cabinetShelves.forEach(shelf => {
                            const shelfItems = this.items.filter(item => item.shelfId === shelf.id && !item.sold);
                            const shelfDiv = document.createElement('div');
                            shelfDiv.className = 'pl-4 border-l-2 border-green-300 dark:border-green-600';
                            
                            shelfDiv.innerHTML = `
                                <div class="flex justify-between items-center mb-1">
                                    <span class="font-medium text-green-600 dark:text-green-400">üìö ${shelf.name}</span>
                                    <span class="text-xs text-gray-500">${shelfItems.length} items</span>
                                </div>
                                <div class="text-xs text-gray-600 dark:text-gray-400 space-y-1">
                                    ${shelfItems.length === 0 ? 
                                        '<div class="text-gray-400">No items</div>' : 
                                        shelfItems.slice(0, 3).map(item => 
                                            `<div class="cursor-pointer hover:text-blue-600 dark:hover:text-blue-400" onclick="inventoryManager.viewItemById('${item.id}')">‚Ä¢ ${item.name || 'Unnamed Item'}</div>`
                                        ).join('') + 
                                        (shelfItems.length > 3 ? `<div class="text-gray-400">... and ${shelfItems.length - 3} more</div>` : '')
                                    }
                                </div>
                            `;
                            shelvesContainer.appendChild(shelfDiv);
                        });
                    }

                    cabinetDiv.appendChild(shelvesContainer);
                    container.appendChild(cabinetDiv);
                });
            }

            renderCompleteItemsList() {
                const container = document.getElementById('overview-items-list');
                container.innerHTML = '';

                const allItems = this.items.sort((a, b) => (a.name || '').localeCompare(b.name || ''));

                if (allItems.length === 0) {
                    container.innerHTML = '<div class="text-gray-500 text-center py-4">No items in inventory</div>';
                    return;
                }

                allItems.forEach(item => {
                    const locationString = this.getLocationString(item);
                    const div = document.createElement('div');
                    div.className = 'flex justify-between items-center p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded cursor-pointer text-sm';
                    div.onclick = () => this.viewItemById(item.id);
                    
                    const statusIcon = item.sold ? 'üî¥' : 'üü¢';
                    const statusText = item.sold ? 'SOLD' : 'Available';
                    
                    div.innerHTML = `
                        <div class="flex-1">
                            <div class="font-medium">${item.name || 'Unnamed Item'}</div>
                            <div class="text-xs text-gray-500">${item.category || 'No category'} | ${item.model || 'No model'}</div>
                        </div>
                        <div class="text-right">
                            <div class="text-xs font-medium">${locationString}</div>
                            <div class="text-xs text-gray-500">${statusIcon} ${statusText}</div>
                        </div>
                    `;
                    container.appendChild(div);
                });
            }

            renderOverviewStatistics() {
                this.renderLocationStatistics();
                this.renderCategoryStatistics();
            }

            renderLocationStatistics() {
                const container = document.getElementById('overview-location-stats');
                container.innerHTML = '';

                const stats = [];
                
                // Items by location
                const itemsByLocation = {};
                this.items.forEach(item => {
                    const location = this.getLocationString(item);
                    itemsByLocation[location] = (itemsByLocation[location] || 0) + 1;
                });

                Object.entries(itemsByLocation)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 5)
                    .forEach(([location, count]) => {
                        const div = document.createElement('div');
                        div.className = 'flex justify-between text-sm';
                        div.innerHTML = `
                            <span class="truncate">${location}</span>
                            <span class="font-medium">${count}</span>
                        `;
                        container.appendChild(div);
                    });

                // Utilization stats
                const unlocatedItems = this.items.filter(item => !item.cabinetId || !item.shelfId).length;
                const utilizationDiv = document.createElement('div');
                utilizationDiv.className = 'mt-3 pt-3 border-t border-gray-200 dark:border-gray-600 text-sm';
                utilizationDiv.innerHTML = `
                    <div class="flex justify-between">
                        <span>Unlocated Items:</span>
                        <span class="font-medium text-orange-600">${unlocatedItems}</span>
                    </div>
                `;
                container.appendChild(utilizationDiv);
            }

            renderCategoryStatistics() {
                const container = document.getElementById('overview-category-stats');
                container.innerHTML = '';

                const categories = {};
                this.items.forEach(item => {
                    const category = item.category || 'Uncategorized';
                    categories[category] = (categories[category] || 0) + 1;
                });

                if (Object.keys(categories).length === 0) {
                    container.innerHTML = '<div class="text-gray-500 text-sm">No data available</div>';
                    return;
                }

                Object.entries(categories)
                    .sort(([,a], [,b]) => b - a)
                    .forEach(([category, count]) => {
                        const div = document.createElement('div');
                        div.className = 'flex justify-between text-sm';
                        div.innerHTML = `
                            <span class="truncate">${category}</span>
                            <span class="font-medium">${count}</span>
                        `;
                        container.appendChild(div);
                    });
            }

            setupOverviewFilters() {
                const cabinetFilter = document.getElementById('overview-cabinet-filter');
                cabinetFilter.innerHTML = '<option value="">All Cabinets</option>';
                
                this.cabinets.forEach(cabinet => {
                    const option = document.createElement('option');
                    option.value = cabinet.id;
                    option.textContent = cabinet.name;
                    cabinetFilter.appendChild(option);
                });

                cabinetFilter.addEventListener('change', () => {
                    this.renderDetailedView();
                });
            }

            selectCabinetInDetailView(cabinetId) {
                document.getElementById('overview-cabinet-filter').value = cabinetId;
                this.renderDetailedView();
            }

            // Overview Quick Actions
            findMisplacedItems() {
                const unlocatedItems = this.items.filter(item => !item.cabinetId || !item.shelfId);
                
                if (unlocatedItems.length === 0) {
                    this.showNotification('All items have locations assigned!', 'success');
                    return;
                }

                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.innerHTML = `
                    <div class="modal-content max-w-2xl">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">Unlocated Items (${unlocatedItems.length})</h3>
                            <button class="text-gray-500 hover:text-gray-700 close-modal">‚úï</button>
                        </div>
                        <div class="max-h-80 overflow-y-auto space-y-2">
                            ${unlocatedItems.map(item => `
                                <div class="flex justify-between items-center p-2 border rounded hover:bg-gray-50 dark:hover:bg-gray-700">
                                    <div>
                                        <div class="font-medium">${item.name || 'Unnamed Item'}</div>
                                        <div class="text-sm text-gray-500">${item.category || 'No category'}</div>
                                    </div>
                                    <button onclick="inventoryManager.viewItemById('${item.id}'); this.closest('.modal').remove();" class="btn btn-primary text-xs">Edit</button>
                                </div>
                            `).join('')}
                        </div>
                        <div class="flex justify-end mt-4">
                            <button class="btn btn-secondary close-modal">Close</button>
                        </div>
                    </div>
                `;

                // Add event listeners
                modal.querySelectorAll('.close-modal').forEach(btn => {
                    btn.addEventListener('click', () => modal.remove());
                });

                document.body.appendChild(modal);
            }

            generateLocationLabels() {
                if (this.cabinets.length === 0) {
                    this.showNotification('No cabinets to generate labels for', 'error');
                    return;
                }

                const printWindow = window.open('', '_blank');
                const labelsHtml = this.cabinets.map(cabinet => {
                    const shelves = this.shelves.filter(s => s.cabinetId === cabinet.id);
                    return `
                        <div style="border: 2px solid #000; padding: 15px; margin: 10px; width: 250px; page-break-inside: avoid;">
                            <h3 style="margin: 0 0 10px 0; font-size: 18px;">${cabinet.name}</h3>
                            <div style="font-size: 12px;">
                                <strong>Shelves:</strong><br>
                                ${shelves.length === 0 ? 'No shelves' : shelves.map(s => `‚Ä¢ ${s.name}`).join('<br>')}
                            </div>
                        </div>
                    `;
                }).join('');

                printWindow.document.write(`
                    <html>
                        <head><title>Location Labels</title></head>
                        <body style="font-family: Arial, sans-serif; padding: 20px;">
                            <h1>Location Labels</h1>
                            <div style="display: flex; flex-wrap: wrap;">
                                ${labelsHtml}
                            </div>
                        </body>
                    </html>
                `);
                printWindow.document.close();
                printWindow.print();
            }

            optimizeLayout() {
                const suggestions = [];
                
                // Find empty cabinets
                const emptyCabinets = this.cabinets.filter(cabinet => {
                    const cabinetItems = this.items.filter(item => item.cabinetId === cabinet.id);
                    return cabinetItems.length === 0;
                });

                if (emptyCabinets.length > 0) {
                    suggestions.push(`‚Ä¢ ${emptyCabinets.length} empty cabinet(s) could be removed or repurposed`);
                }

                // Find overcrowded shelves
                const overcrowdedShelves = this.shelves.filter(shelf => {
                    const shelfItems = this.items.filter(item => item.shelfId === shelf.id && !item.sold);
                    return shelfItems.length > 10; // Threshold for "overcrowded"
                });

                if (overcrowdedShelves.length > 0) {
                    suggestions.push(`‚Ä¢ ${overcrowdedShelves.length} shelf(es) might be overcrowded (>10 items)`);
                }

                // Category clustering suggestions
                const categoryLocations = {};
                this.items.forEach(item => {
                    if (item.category && item.cabinetId) {
                        if (!categoryLocations[item.category]) {
                            categoryLocations[item.category] = new Set();
                        }
                        categoryLocations[item.category].add(item.cabinetId);
                    }
                });

                const scatteredCategories = Object.entries(categoryLocations)
                    .filter(([category, locations]) => locations.size > 2)
                    .length;

                if (scatteredCategories > 0) {
                    suggestions.push(`‚Ä¢ ${scatteredCategories} categories are scattered across multiple cabinets`);
                }

                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">Layout Optimization Suggestions</h3>
                            <button class="text-gray-500 hover:text-gray-700 close-modal">‚úï</button>
                        </div>
                        <div class="space-y-2">
                            ${suggestions.length === 0 ? 
                                '<div class="text-green-600">‚úÖ Your layout looks well organized!</div>' :
                                suggestions.map(s => `<div class="text-gray-700 dark:text-gray-300">${s}</div>`).join('')
                            }
                        </div>
                        <div class="flex justify-end mt-4">
                            <button class="btn btn-secondary close-modal">Close</button>
                        </div>
                    </div>
                `;

                // Add event listeners
                modal.querySelectorAll('.close-modal').forEach(btn => {
                    btn.addEventListener('click', () => modal.remove());
                });

                document.body.appendChild(modal);
            }

            exportLocationReport() {
                const reportData = {
                    generatedDate: new Date().toISOString(),
                    summary: {
                        totalCabinets: this.cabinets.length,
                        totalShelves: this.shelves.length,
                        totalItems: this.items.length,
                        locatedItems: this.items.filter(item => item.cabinetId && item.shelfId).length,
                        unlocatedItems: this.items.filter(item => !item.cabinetId || !item.shelfId).length
                    },
                    locations: this.cabinets.map(cabinet => ({
                        cabinet: cabinet.name,
                        shelves: this.shelves.filter(s => s.cabinetId === cabinet.id).map(shelf => ({
                            shelf: shelf.name,
                            items: this.items.filter(item => item.shelfId === shelf.id).map(item => ({
                                name: item.name,
                                model: item.model,
                                category: item.category,
                                condition: item.condition,
                                sold: item.sold
                            }))
                        }))
                    })),
                    unlocatedItems: this.items.filter(item => !item.cabinetId || !item.shelfId).map(item => ({
                        name: item.name,
                        model: item.model,
                        category: item.category,
                        condition: item.condition,
                        sold: item.sold
                    }))
                };

                const blob = new Blob([JSON.stringify(reportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `location_report_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.showNotification('Location report exported successfully!', 'success');
            }

            // Image Management Methods
            uploadImages() {
                document.getElementById('hidden-file-input').click();
            }

            openCamera() {
                document.getElementById('hidden-camera-input').click();
            }

            async handleFileUpload(event) {
                const files = Array.from(event.target.files);
                
                for (const file of files) {
                    if (file.type.startsWith('image/')) {
                        const imageData = await this.fileToBase64(file);
                        this.currentImages.push({
                            id: this.generateId(),
                            data: imageData,
                            name: file.name,
                            type: file.type,
                            timestamp: new Date().toISOString()
                        });
                    }
                }
                
                this.renderItemImages();
                event.target.value = '';
            }

            renderItemImages() {
                const container = document.getElementById('item-images');
                container.innerHTML = '';

                this.currentImages.forEach(image => {
                    const img = document.createElement('img');
                    img.src = image.data;
                    img.className = 'image-thumbnail';
                    img.onclick = () => this.viewImage(image);
                    container.appendChild(img);
                });
            }

            viewImage(image) {
                this.currentViewingImage = image;
                document.getElementById('image-viewer-img').src = image.data;
                document.getElementById('image-viewer-modal').classList.remove('hidden');
            }

            closeImageViewer() {
                document.getElementById('image-viewer-modal').classList.add('hidden');
                this.currentViewingImage = null;
            }

            deleteImage() {
                if (this.currentViewingImage) {
                    this.currentImages = this.currentImages.filter(img => img.id !== this.currentViewingImage.id);
                    this.renderItemImages();
                    this.closeImageViewer();
                    this.showNotification('Image deleted', 'success');
                }
            }

            loadAllImages() {
                const container = document.getElementById('all-images-grid');
                container.innerHTML = '';

                const allImages = [];
                this.items.forEach(item => {
                    if (item.images && item.images.length > 0) {
                        item.images.forEach(image => {
                            allImages.push({
                                ...image,
                                itemId: item.id,
                                itemName: item.name
                            });
                        });
                    }
                });

                if (allImages.length === 0) {
                    container.innerHTML = '<p class="col-span-full text-center text-gray-500">No images available</p>';
                    return;
                }

                allImages.forEach(image => {
                    const div = document.createElement('div');
                    div.className = 'relative group';
                    div.innerHTML = `
                        <img src="${image.data}" class="image-thumbnail w-full h-32" onclick="inventoryManager.viewItemById('${image.itemId}')">
                        <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-75 text-white text-xs p-1 opacity-0 group-hover:opacity-100 transition-opacity">
                            ${image.itemName || 'Unnamed Item'}
                        </div>
                    `;
                    container.appendChild(div);
                });
            }

            // OCR and AI Methods
            async processOCR() {
                if (this.currentImages.length === 0) {
                    this.showNotification('No images available for OCR', 'error');
                    return;
                }

                this.showLoading('Processing OCR...');

                try {
                    const image = this.currentImages[this.currentImages.length - 1];
                    let extractedText = '';

                    switch (this.settings.ocrMethod) {
                        case 'tesseract':
                            extractedText = await this.tesseractOCR(image.data);
                            break;
                        case 'paddleocr':
                            extractedText = await this.paddleOCR(image.data);
                            break;
                        case 'azure':
                            extractedText = await this.azureOCR(image.data);
                            break;
                        case 'aws':
                            extractedText = await this.awsOCR(image.data);
                            break;
                        default:
                            extractedText = await this.tesseractOCR(image.data);
                    }

                    this.fillFormFromOCR(extractedText);
                    this.showNotification('OCR completed successfully!', 'success');
                } catch (error) {
                    console.error('OCR error:', error);
                    this.showNotification('OCR processing failed', 'error');
                } finally {
                    this.hideLoading();
                }
            }

            async tesseractOCR(imageData) {
                const { data: { text } } = await Tesseract.recognize(imageData, 'eng');
                return text;
            }

            async paddleOCR(imageData) {
                // Fallback to Tesseract if PaddleOCR is not available
                return await this.tesseractOCR(imageData);
            }

            async azureOCR(imageData) {
                // Implementation for Azure OCR would go here
                // Fallback to Tesseract for now
                return await this.tesseractOCR(imageData);
            }

            async awsOCR(imageData) {
                // Implementation for AWS Textract would go here
                // Fallback to Tesseract for now
                return await this.tesseractOCR(imageData);
            }

            fillFormFromOCR(text) {
                // Simple pattern matching to fill form fields
                const lines = text.split('\n').filter(line => line.trim());
                
                // Look for potential item name (usually first meaningful line)
                if (lines.length > 0 && !document.getElementById('item-name').value) {
                    document.getElementById('item-name').value = lines[0].trim();
                }

                // Look for model numbers (patterns like Model: XXX or Model XXX)
                const modelMatch = text.match(/model[:\s]+([^\n\r]+)/i);
                if (modelMatch && !document.getElementById('item-model').value) {
                    document.getElementById('item-model').value = modelMatch[1].trim();
                }

                // Add full text to description if it's empty
                if (!document.getElementById('item-description').value) {
                    document.getElementById('item-description').value = text.trim();
                }
            }

            async processAI() {
                if (this.currentImages.length === 0) {
                    this.showNotification('No images available for AI processing', 'error');
                    return;
                }

                this.showLoading('Processing AI...');

                try {
                    const image = this.currentImages[this.currentImages.length - 1];
                    let description = '';

                    switch (this.settings.aiMethod) {
                        case 'offline':
                            description = await this.offlineAI(image.data);
                            break;
                        case 'openai':
                            description = await this.openAI(image.data);
                            break;
                        case 'cohere':
                            description = await this.cohereAI(image.data);
                            break;
                        case 'claude':
                            description = await this.claudeAI(image.data);
                            break;
                        case 'huggingface':
                            description = await this.huggingFaceAI(image.data);
                            break;
                        default:
                            description = await this.offlineAI(image.data);
                    }

                    this.fillFormFromAI(description);
                    this.showNotification('AI processing completed!', 'success');
                } catch (error) {
                    console.error('AI error:', error);
                    this.showNotification('AI processing failed', 'error');
                } finally {
                    this.hideLoading();
                }
            }

            async offlineAI(imageData) {
                // Simple offline AI - basic image analysis
                return "AI-generated description: This item appears to be an electronic device or component. Please verify and update the details manually.";
            }

            async openAI(imageData) {
                // OpenAI API implementation would go here
                return await this.offlineAI(imageData);
            }

            async cohereAI(imageData) {
                // Cohere API implementation would go here
                return await this.offlineAI(imageData);
            }

            async claudeAI(imageData) {
                // Claude API implementation would go here
                return await this.offlineAI(imageData);
            }

            async huggingFaceAI(imageData) {
                // Hugging Face API implementation would go here
                return await this.offlineAI(imageData);
            }

            fillFormFromAI(description) {
                // Parse AI description to fill form fields
                if (!document.getElementById('item-description').value) {
                    document.getElementById('item-description').value = description;
                }

                // Try to extract item name from description
                if (!document.getElementById('item-name').value) {
                    const nameMatch = description.match(/(?:this is|appears to be|looks like)\s+(?:a|an)?\s*([^.]+)/i);
                    if (nameMatch) {
                        document.getElementById('item-name').value = nameMatch[1].trim();
                    }
                }
            }

            async processAIAndOCR() {
                await this.processOCR();
                await this.processAI();
            }

            async processImageOCR() {
                if (this.currentViewingImage) {
                    this.currentImages = [this.currentViewingImage];
                    await this.processOCR();
                }
            }

            async processImageAI() {
                if (this.currentViewingImage) {
                    this.currentImages = [this.currentViewingImage];
                    await this.processAI();
                }
            }

            scanBarcode() {
                this.showNotification('Barcode scanning feature coming soon', 'warning');
            }

            // Search Methods
            updateSearchFilters() {
                // Update location filter
                const locationSelect = document.getElementById('search-location');
                locationSelect.innerHTML = '<option value="">All Locations</option>';
                
                this.cabinets.forEach(cabinet => {
                    const option = document.createElement('option');
                    option.value = cabinet.id;
                    option.textContent = cabinet.name;
                    locationSelect.appendChild(option);
                });
            }

            searchItems() {
                const searchTerm = document.getElementById('search-input').value.toLowerCase();
                const categoryFilter = document.getElementById('search-category').value;
                const conditionFilter = document.getElementById('search-condition').value;
                const locationFilter = document.getElementById('search-location').value;
                const statusFilter = document.getElementById('search-status').value;

                let filteredItems = this.items.filter(item => {
                    const matchesSearch = !searchTerm || 
                        (item.name && item.name.toLowerCase().includes(searchTerm)) ||
                        (item.model && item.model.toLowerCase().includes(searchTerm)) ||
                        (item.description && item.description.toLowerCase().includes(searchTerm)) ||
                        (item.category && item.category.toLowerCase().includes(searchTerm));

                    const matchesCategory = !categoryFilter || item.category === categoryFilter;
                    const matchesCondition = !conditionFilter || item.condition === conditionFilter;
                    const matchesLocation = !locationFilter || item.cabinetId === locationFilter;
                    const matchesStatus = !statusFilter || 
                        (statusFilter === 'available' && !item.sold) ||
                        (statusFilter === 'sold' && item.sold);

                    return matchesSearch && matchesCategory && matchesCondition && matchesLocation && matchesStatus;
                });

                this.renderSearchResults(filteredItems);
            }

            renderSearchResults(items) {
                const tbody = document.getElementById('search-results');
                tbody.innerHTML = '';

                if (items.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" class="px-4 py-8 text-center text-gray-500">No items found</td></tr>';
                    return;
                }

                items.forEach(item => {
                    const row = document.createElement('tr');
                    row.className = 'border-b dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700';
                    
                    const imageCell = item.images && item.images.length > 0 
                        ? `<img src="${item.images[0].data}" class="w-12 h-12 object-cover rounded">`
                        : '<div class="w-12 h-12 bg-gray-200 dark:bg-gray-600 rounded flex items-center justify-center">üì∑</div>';

                    row.innerHTML = `
                        <td class="px-4 py-2">${item.id}</td>
                        <td class="px-4 py-2">${imageCell}</td>
                        <td class="px-4 py-2">${item.name || 'Unnamed'}</td>
                        <td class="px-4 py-2">${item.model || 'N/A'}</td>
                        <td class="px-4 py-2">${item.category || 'N/A'}</td>
                        <td class="px-4 py-2">${this.getLocationString(item)}</td>
                        <td class="px-4 py-2">
                            <span class="px-2 py-1 rounded text-xs ${item.sold ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">
                                ${item.sold ? 'Sold' : 'Available'}
                            </span>
                        </td>
                        <td class="px-4 py-2">
                            <button onclick="inventoryManager.viewItemById('${item.id}')" class="btn btn-primary text-xs">View</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }

            clearSearch() {
                document.getElementById('search-input').value = '';
                document.getElementById('search-category').value = '';
                document.getElementById('search-condition').value = '';
                document.getElementById('search-location').value = '';
                document.getElementById('search-status').value = '';
                
                const tbody = document.getElementById('search-results');
                tbody.innerHTML = '<tr><td colspan="8" class="px-4 py-8 text-center text-gray-500">Use the search box above to find items</td></tr>';
            }

            // Settings Methods
            loadSettings() {
                document.getElementById('ocr-method').value = this.settings.ocrMethod;
                document.getElementById('ai-method').value = this.settings.aiMethod;
                document.getElementById('auto-save').checked = this.settings.autoSave;
                
                // Load API keys (if stored)
                Object.keys(this.settings.apiKeys || {}).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        element.value = this.settings.apiKeys[key];
                    }
                });
            }

            saveSettings() {
                this.settings.ocrMethod = document.getElementById('ocr-method').value;
                this.settings.aiMethod = document.getElementById('ai-method').value;
                this.settings.autoSave = document.getElementById('auto-save').checked;
                this.settings.autoBackup = document.getElementById('auto-backup').checked;
                
                this.settings.apiKeys = {
                    'azure-ocr-key': document.getElementById('azure-ocr-key').value,
                    'aws-access-key': document.getElementById('aws-access-key').value,
                    'aws-secret-key': document.getElementById('aws-secret-key').value,
                    'openai-key': document.getElementById('openai-key').value,
                    'cohere-key': document.getElementById('cohere-key').value,
                    'claude-key': document.getElementById('claude-key').value,
                    'huggingface-key': document.getElementById('huggingface-key').value
                };

                // Save to global variable since localStorage is not available
                window.inventoryAppSettings = this.settings;
                this.showNotification('Settings saved successfully!', 'success');
            }

            validateSettings() {
                this.showNotification('Validating API connections...', 'warning');
                // Implementation for API validation would go here
                setTimeout(() => {
                    this.showNotification('API validation completed', 'success');
                }, 2000);
            }

            // Data Management Methods
            exportDatabase() {
                const data = {
                    items: this.items,
                    cabinets: this.cabinets,
                    shelves: this.shelves,
                    settings: this.settings,
                    exportDate: new Date().toISOString()
                };

                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `inventory_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.showNotification('Database exported successfully!', 'success');
            }

            importDatabase(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        this.showConfirmDialog('This will replace all current data. Continue?', () => {
                            this.items = data.items || [];
                            this.cabinets = data.cabinets || [];
                            this.shelves = data.shelves || [];
                            if (data.settings) {
                                this.settings = { ...this.settings, ...data.settings };
                            }
                            
                            this.saveData();
                            this.updateUI();
                            this.showNotification('Database imported successfully!', 'success');
                        });
                    } catch (error) {
                        console.error('Import error:', error);
                        this.showNotification('Failed to import database', 'error');
                    }
                };
                reader.readAsText(file);
                event.target.value = '';
            }

            // Utility Methods
            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }

            async fileToBase64(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            }

            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }

            showLoading(message = 'Loading...') {
                document.getElementById('loading-text').textContent = message;
                document.getElementById('loading-overlay').classList.remove('hidden');
            }

            hideLoading() {
                document.getElementById('loading-overlay').classList.add('hidden');
            }

            showNotification(message, type = 'success') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }

            showConfirmDialog(message, onConfirm) {
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.innerHTML = `
                    <div class="modal-content">
                        <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                        <div class="flex justify-end space-x-3">
                            <button class="btn btn-secondary confirm-cancel">Cancel</button>
                            <button class="btn btn-danger confirm-ok">Confirm</button>
                        </div>
                    </div>
                `;
                
                // Add event listeners
                const cancelBtn = modal.querySelector('.confirm-cancel');
                const confirmBtn = modal.querySelector('.confirm-ok');
                
                cancelBtn.addEventListener('click', () => {
                    modal.remove();
                });
                
                confirmBtn.addEventListener('click', () => {
                    modal.remove();
                    onConfirm();
                });
                
                document.body.appendChild(modal);
            }

            showPromptDialog(message, onConfirm, defaultValue = '') {
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.innerHTML = `
                    <div class="modal-content">
                        <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                        <input type="text" class="form-input mb-4 prompt-input" value="${defaultValue}">
                        <div class="flex justify-end space-x-3">
                            <button class="btn btn-secondary prompt-cancel">Cancel</button>
                            <button class="btn btn-primary prompt-ok">OK</button>
                        </div>
                    </div>
                `;
                
                // Add event listeners
                const cancelBtn = modal.querySelector('.prompt-cancel');
                const okBtn = modal.querySelector('.prompt-ok');
                const inputField = modal.querySelector('.prompt-input');
                
                cancelBtn.addEventListener('click', () => {
                    modal.remove();
                });
                
                okBtn.addEventListener('click', () => {
                    const value = inputField.value;
                    modal.remove();
                    onConfirm(value);
                });
                
                // Handle Enter key
                inputField.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const value = inputField.value;
                        modal.remove();
                        onConfirm(value);
                    }
                });
                
                document.body.appendChild(modal);
                
                // Focus on input
                setTimeout(() => {
                    inputField.focus();
                    inputField.select();
                }, 100);
            }

            toggleTheme() {
                const html = document.documentElement;
                if (html.classList.contains('dark')) {
                    html.classList.remove('dark');
                    // Store theme preference in global variable since localStorage is not available
                    window.inventoryTheme = 'light';
                } else {
                    html.classList.add('dark');
                    window.inventoryTheme = 'dark';
                }
            }

            // Android Features
            openGoogleLens() {
                // Check if running on Android
                const isAndroid = /Android/i.test(navigator.userAgent);
                
                if (isAndroid) {
                    try {
                        // Try to open Google Lens directly
                        const googleLensUrl = 'https://lens.google.com/';
                        const intent = `intent://lens.google.com/#Intent;scheme=https;package=com.google.ar.lens;end`;
                        
                        // Try to open the Google Lens app
                        window.location.href = intent;
                        
                        // Fallback to web version after a delay
                        setTimeout(() => {
                            window.open(googleLensUrl, '_blank');
                        }, 2000);
                        
                        this.showNotification('Opening Google Lens...', 'success');
                    } catch (error) {
                        this.showNotification('Google Lens not available, using camera instead', 'warning');
                        this.openCamera();
                    }
                } else {
                    this.showNotification('Google Lens is optimized for Android devices', 'warning');
                    this.openCamera();
                }
            }

            // Android file saving
            async saveToAndroidDirectory() {
                try {
                    // Check if File System Access API is available
                    if ('showDirectoryPicker' in window) {
                        const dirHandle = await window.showDirectoryPicker();
                        
                        const data = {
                            items: this.items,
                            cabinets: this.cabinets,
                            shelves: this.shelves,
                            settings: this.settings,
                            exportDate: new Date().toISOString()
                        };

                        const fileName = `inventory_backup_${new Date().toISOString().split('T')[0]}.json`;
                        const fileHandle = await dirHandle.getFileHandle(fileName, { create: true });
                        const writable = await fileHandle.createWritable();
                        
                        await writable.write(JSON.stringify(data, null, 2));
                        await writable.close();
                        
                        this.showNotification('Data saved to Android directory successfully!', 'success');
                    } else {
                        // Fallback to regular download
                        this.exportDatabase();
                    }
                } catch (error) {
                    console.error('Android save error:', error);
                    this.showNotification('Failed to save to Android directory, using download instead', 'warning');
                    this.exportDatabase();
                }
            }

            // Google Sign-In and Cloud Storage
            async initGoogleSignIn() {
                try {
                    await new Promise((resolve) => {
                        gapi.load('auth2:client:drive', resolve);
                    });

                    await gapi.client.init({
                        apiKey: 'YOUR_API_KEY',
                        clientId: 'YOUR_CLIENT_ID',
                        discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],
                        scope: 'https://www.googleapis.com/auth/drive.file'
                    });

                    this.authInstance = gapi.auth2.getAuthInstance();
                    this.showNotification('Google Sign-In initialized', 'success');
                } catch (error) {
                    console.error('Google Sign-In init error:', error);
                    this.showNotification('Google Sign-In not available', 'warning');
                }
            }

            async signInToGoogle() {
                try {
                    if (!this.authInstance) {
                        await this.initGoogleSignIn();
                    }

                    const user = await this.authInstance.signIn();
                    this.googleUser = user;
                    this.showNotification('Signed in to Google successfully!', 'success');
                    
                    // Auto-backup to Google Drive
                    await this.backupToGoogleDrive();
                } catch (error) {
                    console.error('Google Sign-In error:', error);
                    this.showNotification('Failed to sign in to Google', 'error');
                }
            }

            async backupToGoogleDrive() {
                if (!this.googleUser || !this.googleUser.isSignedIn()) {
                    this.showNotification('Please sign in to Google first', 'warning');
                    return;
                }

                try {
                    this.showLoading('Backing up to Google Drive...');

                    const data = {
                        items: this.items,
                        cabinets: this.cabinets,
                        shelves: this.shelves,
                        settings: this.settings,
                        backupDate: new Date().toISOString()
                    };

                    const fileMetadata = {
                        name: `inventory_backup_${new Date().toISOString().split('T')[0]}.json`,
                        parents: ['appDataFolder']
                    };

                    const form = new FormData();
                    form.append('metadata', new Blob([JSON.stringify(fileMetadata)], {type: 'application/json'}));
                    form.append('file', new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'}));

                    const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                        method: 'POST',
                        headers: new Headers({
                            'Authorization': `Bearer ${this.googleUser.getAuthResponse().access_token}`
                        }),
                        body: form
                    });

                    if (response.ok) {
                        this.showNotification('Backup saved to Google Drive successfully!', 'success');
                    } else {
                        throw new Error('Failed to upload to Google Drive');
                    }
                } catch (error) {
                    console.error('Google Drive backup error:', error);
                    this.showNotification('Failed to backup to Google Drive', 'error');
                } finally {
                    this.hideLoading();
                }
            }

            async restoreFromGoogleDrive() {
                if (!this.googleUser || !this.googleUser.isSignedIn()) {
                    this.showNotification('Please sign in to Google first', 'warning');
                    return;
                }

                try {
                    this.showLoading('Restoring from Google Drive...');

                    // List files in appDataFolder
                    const response = await fetch(
                        `https://www.googleapis.com/drive/v3/files?spaces=appDataFolder&q=name contains 'inventory_backup'&orderBy=createdTime desc`,
                        {
                            headers: {
                                'Authorization': `Bearer ${this.googleUser.getAuthResponse().access_token}`
                            }
                        }
                    );

                    const fileList = await response.json();
                    
                    if (fileList.files && fileList.files.length > 0) {
                        // Get the most recent backup
                        const latestFile = fileList.files[0];
                        
                        // Download the file content
                        const fileResponse = await fetch(
                            `https://www.googleapis.com/drive/v3/files/${latestFile.id}?alt=media`,
                            {
                                headers: {
                                    'Authorization': `Bearer ${this.googleUser.getAuthResponse().access_token}`
                                }
                            }
                        );

                        const fileContent = await fileResponse.text();
                        const data = JSON.parse(fileContent);

                        this.showConfirmDialog('This will replace all current data with the latest Google Drive backup. Continue?', () => {
                            this.items = data.items || [];
                            this.cabinets = data.cabinets || [];
                            this.shelves = data.shelves || [];
                            if (data.settings) {
                                this.settings = { ...this.settings, ...data.settings };
                            }
                            
                            this.saveData();
                            this.updateUI();
                            this.showNotification('Data restored from Google Drive successfully!', 'success');
                        });
                    } else {
                        this.showNotification('No backups found in Google Drive', 'warning');
                    }
                } catch (error) {
                    console.error('Google Drive restore error:', error);
                    this.showNotification('Failed to restore from Google Drive', 'error');
                } finally {
                    this.hideLoading();
                }
            }

            // Camera Methods
            async openCameraModal() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                    const video = document.getElementById('camera-video');
                    video.srcObject = stream;
                    video.play();
                    document.getElementById('camera-modal').classList.remove('hidden');
                } catch (error) {
                    console.error('Camera error:', error);
                    this.showNotification('Camera access denied or not available', 'error');
                }
            }

            capturePhoto() {
                const video = document.getElementById('camera-video');
                const canvas = document.createElement('canvas');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                
                const ctx = canvas.getContext('2d');
                ctx.drawImage(video, 0, 0);
                
                const imageData = canvas.toDataURL('image/jpeg');
                this.currentImages.push({
                    id: this.generateId(),
                    data: imageData,
                    name: `camera_${Date.now()}.jpg`,
                    type: 'image/jpeg',
                    timestamp: new Date().toISOString()
                });
                
                this.renderItemImages();
                this.closeCamera();
                this.showNotification('Photo captured successfully!', 'success');
            }

            closeCamera() {
                const video = document.getElementById('camera-video');
                if (video.srcObject) {
                    video.srcObject.getTracks().forEach(track => track.stop());
                }
                document.getElementById('camera-modal').classList.add('hidden');
            }
        }

        // Initialize the application
        const inventoryManager = new InventoryManager();
        window.inventoryManager = inventoryManager;
    </script>
</body>
</html>